generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type Scores {

  first_trimester Int

  second_trimester Int

  third_trimester Int

}

type Education {

  level String

  status Edu_STAT @default(ONGOING)

  score Scores

  overall_score Int

  year Int

  institute String

  speciality String

}


type Address {

  street String

  village String

  town String

  city String

  postal_code Int

  number Int

}


type Info {

  firstname String

  lastname String

  birthdate DateTime

  gender String

  email String

  phone String

  username String

  role Role @default(USER)

}


type Parent {

  info Info

  cin_number Int

  address Address

  health_status String

  health_ensurance String

  job String

  income String

  home_status String

  deceased_parent_name String

  deceased_parent_cin Int

  cause_of_death String

  sponsor_name String

  family_status String

}


model User {

  id String @id @default(auto()) @map("_id") @db.ObjectId

  info Info

  createdAt DateTime  @default(now()) @map(name: "created_at")
  
  updatedAt DateTime  @updatedAt @map(name: "updated_at")

  @@unique([info.email, info.username])

  @@map("users")
}


model Orphan {

  id String @id @default(auto()) @map("_id") @db.ObjectId

  info Info

  health_status String

  family   Family   @relation(fields: [familyId], references: [id])
  
  familyId String @db.ObjectId

  education Education[]

  updatedAt DateTime  @updatedAt @map(name: "updated_at")  

  @@map("orphans")

}

model Family {

  id String @id @default(auto()) @map("_id") @db.ObjectId

  parent Parent

  Orphans Orphan[]

  @@unique([parent.cin_number, parent.deceased_parent_cin])  

  @@map("families")
}

model Subsidy {
  
  id String @id @default(auto()) @map("_id") @db.ObjectId

  title String

  unit_price Int

  quantity String

  status String

  @@map("subsidies")
}

enum Edu_STAT {
  ONGOING
  FAILED
  PASSED
}


enum Role {
  ORPHAN
  PARENT
  USER
  MODERATOR
  ADMIN
}